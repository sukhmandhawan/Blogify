<%= render partial: 'users/shared/header' %>
<div class="flex flex-col  p-4 pt-32 bg-slate-400 min-h-screen">
  <div class="flex flex-col bg-white p-4 m-2 rounded-lg shadow-lg shadow-indigo-500/40">

    <div class="flex flex-row justify-between m-2">
      <h2 class="font-bold text.lg">Post #<%= @post.id %> by <%= link_to @post.author.name, user_path(@post.author) %></h2>
      <%= form_with(url: user_post_likes_path(@author, @post), method: :post, local: true) do |form| %>
        <%= form.hidden_field :author_id, value: current_user.id %>
        <%= form.button type: "submit", class: "flex items-center", style: "background: none; border: none;" do %>
          <%= image_tag("icons/like.svg", alt: "Like icon", class: "w-6 h-6 mr-1") %>
        <% end %>
      <% end %>
      
    </div>

    <p class="m-2"><%= @post.text %></p>

    <div class="flex items-center gap-2 m-2">
      <%= image_tag("icons/comment", alt: "comment icon", width: 30, height: 30) %>
      <span class="ml-1"><%= @post.comments.count %></span>
      
      <%= image_tag("icons/like", alt: "like icon", width: 30, height: 30) %>
      <span class="ml-1"><%= @post.likes.count %></span>
    </div>

   

    <% @post.comments.each do |comment| %>

      <div class="rounded-lg bg-slate-200 border-none p-2 flex flex-col m-2 gap-2">
        <strong><%= comment.author.name %>:</strong> <%= comment.text %>
        <% if can? :destroy, comment %>
        <%= button_to "/users/#{@user.id}/posts/#{comment.post.id}/comments/#{comment.id}", method: :delete, data: { confirm: 'Are you sure?' } do %>
          <%= image_tag("icons/delete", alt: "Delete icon", width: 20, height: 20) %>
        <% end %>

        <% end %>
      </div>
    
    <% end %>

    <%= form_with(model: [ @post, @post.comments.build ], url: user_post_comments_path(@post.author, @post), local: true, html: { class: 'm-4 flex flex-col gap-2' }) do |form| %>
      <%= form.hidden_field :author_id, value: current_user.id %>
      <%= form.text_area :text, placeholder: "Leave a comment...", rows: 5, class: 'rounded-lg bg-slate-200 border-none' %>
      <%= form.submit "Add Comment", class: 'bg-slate-600 hover:bg-slate-700 text-white p-2 rounded-lg font-bold' %>
    <% end %>
  </div>    
      
    <% if can? :destroy, @post %>
    <%= button_to 'Delete Post', "/users/#{@user.id}/posts/#{@post.id}", method: :delete, data: { confirm: 'Are you sure?' }, class: 'bg-slate-200 hover:bg-slate-300 text-black p-2 rounded-lg font-bold m-2' %>
    <% end %>
  
<%= link_to user_path(current_user), class: 'm-auto mt-4' do %>
  <%= image_tag("icons/back", alt: "Back icon", width: 35, height: 35) %>
<% end %>

</div>
<%= render partial: 'users/shared/footer' %>